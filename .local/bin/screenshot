#!/usr/bin/env bash

# screenshot script
# for wayland
# dependencies: grim, slurp, wl-clipboard, rofi (optional)
# usage: screenshot [flag]

# screenshot
dir="$(xdg-user-dir PICTURES)/Screenshots"
file="$(date +%Y%m%d_%Hh%Mm%Ss_grim.png)"

# directory
if [[ ! -d "$dir" ]]; then
	mkdir -p "$dir"
fi

# notify and view screenshot
notify_view() {
	if [[ -e "$dir/$file" ]]; then
		notify-send -h int:transient:1 \
		            -h string:x-dunst-stack-tag:screenshot \
		            "Screenshot taken"
	else
		notify-send -h int:transient:1 \
		            -h string:x-dunst-stack-tag:screenshot \
		            "Screenshot deleted"
	fi
}

# countdown
countdown () {
  for sec in $(seq "$1" -1 1); do
		notify-send -t 1000 -h int:transient:1 -h string:x-dunst-stack-tag:screenshottimer "Taking shot in: $sec"
		sleep 1
	done
}

# take shots
shotnow () {
	sleep 0.1 && grim - | tee "$dir"/"$file" | wl-copy
  notify_view
}

shot5 () {
	countdown '5'
	sleep 0.5 && grim - | tee "$dir"/"$file" | wl-copy
	notify_view
}

shot10 () {
	countdown '10'
	sleep 0.5 && grim - | tee "$dir"/"$file" | wl-copy
	notify_view
}

shotarea () {
	grim -g "$(slurp)" - | tee "$dir"/"$file"| wl-copy
  notify_view
}

# run
case "${1:-}" in
  --now) sleep 0.1s && shotnow && exit 0 ;;
  --area) sleep 0.1s && shotarea && exit 0 ;;
  --delay5) shot5 && exit 0 ;;
  --delay10) shot10 && exit 0 ;;
esac
